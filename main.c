#include "pico/stdlib.h"
#include "src/mrubyc.h"
#include "hardware/timer.h"
#include "hardware/clocks.h"
#include "hardware/irq.h"
#include "hardware/structs/scb.h"
#include "hardware/sync.h"
#define MEMORY_SIZE (1024*20)

uint8_t sample1[] = {
0x52,0x49,0x54,0x45,0x30,0x30,0x30,0x36,0xd1,0x25,0x00,0x00,0x00,0x83,0x4d,0x41,
0x54,0x5a,0x30,0x30,0x30,0x30,0x49,0x52,0x45,0x50,0x00,0x00,0x00,0x65,0x30,0x30,
0x30,0x32,0x00,0x00,0x00,0xe7,0x00,0x01,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x2e,
0x21,0x00,0x23,0x10,0x01,0x07,0x02,0x2e,0x01,0x00,0x01,0x10,0x01,0x07,0x02,0x2e,
0x01,0x01,0x01,0x10,0x01,0x06,0x02,0x2e,0x01,0x00,0x01,0x10,0x01,0x07,0x02,0x2e,
0x01,0x01,0x01,0x11,0x01,0x22,0x01,0x00,0x03,0x0f,0x01,0x37,0x01,0x67,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x0a,0x6c,0x65,0x64,0x31,0x5f,0x77,0x72,0x69,
0x74,0x65,0x00,0x00,0x05,0x73,0x6c,0x65,0x65,0x70,0x00,0x45,0x4e,0x44,0x00,0x00,
0x00,0x00,0x08,
};
static uint8_t memory_pool[MEMORY_SIZE];

static void c_led1_write(mrb_vm *vm, mrb_value *v, int argc) {
    int set_value = GET_INT_ARG(1);
    gpio_put(25,set_value);
}

int hal_write(int fd, const void *buf, int nbytes) {
    return 0;
}
int hal_flush(int fd) {
    return 0;
}

int main() {
    stdio_init_all();
    gpio_init(25);
    gpio_set_dir(25, GPIO_OUT);
    mrbc_init(memory_pool, MEMORY_SIZE);
    mrbc_define_method(0, mrbc_class_object, "led1_write", c_led1_write);
    mrbc_create_task(sample1, 0);
    mrbc_run();
    return 1;
}
